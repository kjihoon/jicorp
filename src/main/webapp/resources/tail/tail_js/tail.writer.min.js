/* tail.writer 0.3.1 @ https://github.com/pytesNET/tail.writer */
(function(a,b){"use strict";var c={hasClass:function(k,l){var m=new RegExp("(|s+)"+l+"(s+|)");return m.test(k.className)},addClass:function(k,l){return this.hasClass(k,l)||(k.className=(k.className.trim()+" "+l.trim()).trim()),k},removeClass:function(k,l){var m=new RegExp("(|s+)("+l+")(s+|)");return m.test(k.className)&&(k.className=k.className.replace(m,"$1$3").trim()),k},position:function(k,l){var m={top:k.offsetTop||0,left:k.offsetLeft||0,width:k.offsetWidth||0,height:k.offsetHeight||0};if(l)for(;k=k.offsetParent;)m.top+=k.offsetTop,m.left+=k.offsetLeft;return m},trigger:function(k,l,m){if(CustomEvent&&"undefined"!=typeof CustomEvent){var n=new CustomEvent(l,m);return k.dispatchEvent(n)}var n=b.createEvent("CustomEvent");return n.initCustomEvent(l,!!m.bubbles,!!m.cancelable,m.detail),k.dispatchEvent(n)},animate:function(k,l,m,n){if(k.hasAttribute("data-tail-animation")){if(!n)return;clearInterval(c.animation[k.getAttribute("data-tail-animation")])}k.setAttribute("data-tail-animation","tail-"+ ++this.animationCounter),this.animation["tail-"+this.animationCounter]=setInterval(function(o,p,q){var r=o.getAttribute("data-tail-animation");!1==p(o)&&(clearInterval(q.animation[r]),o.parentElement&&o.removeAttribute("data-tail-animation"))},m,k,l,this)},animation:{},animationCounter:0},f=function(k,l){if("string"==typeof k&&(k=b.querySelectorAll(k)),k instanceof NodeList||k instanceof HTMLCollection){if(0==k.length)return!1;for(var m=[],n=0;n<k.length;n++)m.push(new f(k[n],l));return m}return"undefined"==typeof this?new f(k,l):!!(k instanceof Element)&&(k.hasAttribute("data-writer")&&f.instances[k.getAttribute(k,"data-writer")]?f.instances[k.getAttribute("data-writer")]:(this.e={container:"",editor:k,toolbar:"",statusbar:""},this.id=++f.counter,this.con=Object.assign({},f.defaults,"undefined"==typeof l?{}:l),f.instances[this.id]=this.build(),this))};f.status="alpha",f.version="0.3.1",f.counter=0,f.instances={},f.placeholder="placeholder"in b.createElement("input"),f.defaults={width:"100%",height:["200px","500px"],classes:"",resize:!0,indentTab:!1,indentSize:4,toolbar:["headers","|","bold","italic","strikethrough","|","quote","code","codeblock","indent","outdent","|","link","image","table","hr","|","list:unordered","list:ordered","|","preview"],toolbarPosition:"top",tooltip:"top",statusbar:!0},f.actions={bold:{syntax:"**$1**",callback:"inline"},italic:{syntax:"_$1_",callback:"inline"},underline:{syntax:"<u>$1</u>",callback:"inline"},strikethrough:{syntax:"~~$1~~",callback:"inline"},code:{syntax:"`$1`",callback:"inline"},hr:{syntax:"----------",callback:"block",filter:function(k,l,m){return k.length!=k.lastIndexOf("\n")+1&&(l="\n"+l),0>m.indexOf("\n")&&0>=l.indexOf("\n")&&(l+="\n"),l}},codeblock:{syntax:"```\n$1\n```",callback:"inline",filter:function(k,l,m,n){return l==this.syntax.replace("$1","")?l:(l=l.replace(/```\n\n```/g,""),n.start+=this.syntax.indexOf("$1"),n.end=l.length-this.syntax.indexOf("$1"),l)}},quote:{syntax:">\t$1",callback:"block",walker:!0},indent:{syntax:"\t$1",callback:function(){var n=this.selection(),o=this,p=this.val.slice(0,n.start),q=this.val.slice(n.start,n.end),r=this.val.slice(n.end);return(this.indent=this.indenter(this.lines.current,"count")+1,-1==q.indexOf("\n"))?this.writeLine(this.indenter("\t","create"),"before"):(q=q.replace(/[^|\n].*/g,function(t){return o.indenter("\t","create")+t}),n.end=p.length+q.length,this.write(p+q+r,n))}},outdent:{syntax:!1,callback:function(){var n=this.selection(),o=this.val.slice(0,n.start),p=this.val.slice(n.start,n.end),q=this.val.slice(n.end,this.val.length),r=this.indenter("\t"),t=new RegExp("\n"+r,"g");if(/\n/.test(p))p=p.replace(t,"\n",p);else if(0==this.lines.current.indexOf(r)){var u=o.slice(0,o.lastIndexOf("\n")+1),v=o.slice(o.lastIndexOf("\n")+1+r.length,o.length);o=u+v}return 0==p.indexOf(r)&&(p=p.slice(r.length)),n.start=o.length,n.end=o.length+p.length,this.write(o+p+q,n)}},header:{syntax:function(k){return k=1<=k&&6>=k?parseInt(k):1,1==k?"$1\n==========":2==k?"$1\n----------":Array(k+1).join("#")+" $1"},callback:"block",filter:function(k,l,m,n){return("\n=========="==l||"\n----------"==l)&&(n.start=n.end=k.length),l}},list:{title:function(k){var k="undefined"==typeof k?"unordered":k;return"list"+k[0].toUpperCase()+k.slice(1)},syntax:function(k){return"checked"===k?"- [x]\t$1":"unchecked"===k?"- [ ]\t$1":"ordered"===k?"1.\t$1":"-\t$1"},filter:function(k,l){if(0!==l.indexOf("1."))return l;var n=k.match(/^([0-9]+)\.\s+/gm);return n?l.replace("1",(n.length+1).toString()):l},callback:"block",walker:!0},headers:{syntax:self.header,callback:function(k,l,m,n){for(var o="<form>",p=1;p<=(0<n.length&&"x3"==n[0]?3:6);p++)o+="<div class=\"tail-writer-item tail-writer-item-header-"+p+"\">   <button onclick=\"this.parentElement.parentElement.querySelector('input').value = "+p+";\">       <span class=\"icon-header-"+p+"\" ></span> Header "+p+"   </button></div>";o+="<input type=\"hidden\" name=\"header\" value=\"\" /></form>",this.showDropdown(m+(0<n.length?"-"+n.join("-"):""),o,function(q){var t=parseInt(q.header.value);return this.perform("header",[1>t||6<t||isNaN(t)?1:t]),!0})}},link:{syntax:"[$1](url)",callback:function(k,l,m,n){if(0==n.length)return this.do_inline(k,l,m);var o="<form>   <div class=\"tail-writer-row\">       <span class=\"tail-writer-label tail-writer-label-title\">"+j(m+"Title")+"</span>       <input type=\"text\" name=\"title\" value=\"\" class=\"field-text\" placeholder=\""+j(m+"Title")+"\" />   </div>   <div class=\"tail-writer-row\">       <span class=\"tail-writer-label tail-writer-label-url\">"+j(m+"URL")+"</span>       <input type=\"text\" name=\"url\" value=\"\" class=\"field-text\" placeholder=\""+j(m+"URL")+"\" />   </div>   <div>       <button name=\"type\" value=\""+m+"\">"+j(m+"Create")+"</button>   </div></form>",p=this,q=function(r){var t=f.actions[r.type.value].syntax+" ";return t=t.replace("url",r.url.value).replace("$1",r.title.value),p.do_inline(t,p,m),!0};"dropdown"==n[0]?this.showDropdown(m+"-dropdown",o,q):this.showDialog(m+"-dialog",o,q)},filter:function(k,l,m,n){return"[](url)"==l?(n.end+="link-title".length,"[link-title](url)"):l}},image:{syntax:"![$1](url)",callback:function(k,l,m,n){f.actions.link.callback.call(this,k,l,m,n)},filter:function(k,l,m,n){return"![](url)"==l?(n.end+="image-title".length,"![image-title](url)"):l}},table:{syntax:!1,callback:function(k,l,m,n){var o="<form>   <div class=\"tail-writer-row\">       <span class=\"tail-writer-label tail-writer-label-rows\">"+j("tableRows")+"</span>       <input type=\"number\" name=\"rows\" value=\"3\" class=\"field-number\" placeholder=\""+j("tableRows")+"\" />   </div>   <div class=\"tail-writer-row\">       <span class=\"tail-writer-label tail-writer-label-cols\">"+j("tableCols")+"</span>       <input type=\"number\" name=\"cols\" value=\"3\" class=\"field-number\" placeholder=\""+j("tableCols")+"\" />   </div>   <div class=\"tail-writer-row\">       <input type=\"checkbox\" id=\"tail-writer-table-head-"+this.id+"\" name=\"head\" value=\"1\" class=\"field-header\" />       <label for=\"tail-writer-table-head-"+this.id+"\">"+j("tableHead")+"</label>   </div>   <div>       <button>"+j("tableCreate")+"</button>   </div></form>",p=this,q=function(r){var t=r.head.checked,u=parseInt(r.rows.value),v=parseInt(r.cols.value);u=isNaN(u)?3:u,v=isNaN(v)?3:v;for(var x="",y=12,z=0;z<=u;z++)if(t||0!=z){for(var A=1;A<=v;A++){x+="| ";for(var B=0;B<y;B++)x+=" ";x+=" "}if(x+="|\n",0==z){for(var A=1;A<=v;A++){x+="| ";for(var B=0;B<y;B++)x+="-";x+=" "}x+="|\n"}}return this.do_block(x,p,"table"),!0};"dropdown"==n[0]?this.showDropdown(m+"-dropdown",o,q):this.showDialog(m+"-dialog",o,q)}}},"undefined"!=typeof marked&&(f.actions.preview={syntax:!1,callback:function(){if(!c.hasClass(this.current,"active")){var n=this.e.editor.value;0==n.length&&(n=j("previewEmpty"));var o=b.createElement("DIV");o.innerHTML=f.parse(n),o.className="tail-writer-preview",o.style.width=this.e.editor.outerWidth,o.style.height=this.e.editor.outerHeight,c.removeClass(this.current,"icon-preview"),c.addClass(this.current,"active icon-editor"),c.addClass(this.e.container,"tail-writer-preview"),this.current.setAttribute("data-writer-title",j("previewExit")),this.e.editor.style.display="none",this.e.container.insertBefore(o,this.e.editor);for(var p=this.e.toolbar.querySelectorAll("button:not(.icon-editor)"),q=0;q<p.length;q++)c.addClass(p[q],"disabled")}else{c.removeClass(this.current,"active icon-editor"),c.removeClass(this.e.container,"tail-writer-preview"),c.addClass(this.current,"icon-preview"),this.current.setAttribute("data-writer-title",j("preview")),this.e.container.removeChild(this.e.container.querySelector(".tail-writer-preview")),this.e.editor.style.display="block";for(var p=this.e.toolbar.querySelectorAll("button.disabled"),q=0;q<p.length;q++)c.removeClass(p[q],"disabled")}if(MouseEvent&&"undefined"!=typeof MouseEvent){var r=new MouseEvent("mouseout");this.current.dispatchEvent(r),setTimeout(function(t){var u=new MouseEvent("mouseover");t.dispatchEvent(u)},200,this.current)}else if(document.createEvent){var r=document.createEvent("MouseEvent");r.initEvent("mouseout",!0,!1,{}),this.current.dispatchEvent(r),setTimeout(function(t){var u=document.createEvent("MouseEvent");u.initEvent("mouseover",!0,!1,{}),t.dispatchEvent(u)},200,this.current)}}});var g=function(k,l){if("string"==typeof k&&f.actions.hasOwnProperty(k))var m=f.actions[k];else return!1;return m.markup="function"==typeof m.syntax?m.syntax.apply(m,l):m.syntax,m.id=k+(0<l.length?"-"+l.join("-"):""),m.string="function"==typeof m.title?j(m.title.apply(m,l)):j(k),m},h=function(k,l,m,n,o){return"function"==typeof k.filter?k.filter.call(k,l,m,n,o):m};f.strings={bold:"Bold",italic:"Italic",underline:"Underline",strikethrough:"Strikethrough",code:"Inline Code",link:"Link",image:"Image",hr:"Horizontal Rule",quote:"Blockquote",indent:"Indent",outdent:"Outdent",header:"Header",codeblock:"Code Block",listOrdered:"Ordered List",listUnordered:"Unordered List",listChecked:"Checked List",listUnchecked:"Unchecked List",headers:"Headers",table:"Table",tableRows:"Rows",tableCols:"Columns",tableHead:"Include Header",tableCreate:"Create Table",linkDialog:"Link (Dialog)",imageDialog:"Image (Dialog)",tableDialog:"Table (Dialog)",linkTitle:"Link Title",linkURL:"Link URL",linkCreate:"Add Link",imageTitle:"Image Title",imageURL:"Image URL",imageCreate:"Add Image",lineCounter:"Lines",charCounter:"Characters",wordCounter:"Words"},"undefined"!=typeof marked&&(f.strings.preview="Preview",f.strings.previewEmpty="Nothing to preview yet!",f.strings.previewExit="Exit Preview Mode");var j=function(k){return f.strings.hasOwnProperty(k)?f.strings[k]:k};f.parse=function(k){if("undefined"==typeof marked)return k;var l=new marked.Renderer;return l.listitem=function(m){return /^\s*\[[x ]\]\s*/.test(m)?(m=m.replace(/^\s*\[ \]\s*/,"<input type=\"checkbox\"> ").replace(/^\s*\[x\]\s*/,"<input type=\"checkbox\" checked> "),"<li style=\"list-style: none\">"+m+"</li>"):"<li>"+m+"</li>"},marked(k,{renderer:l})},f.extend=function(k,l,m){return!f.actions.hasOwnProperty(k)&&("object"!=typeof l||"object"!=typeof m?!1:(f.actions[k]=l,f.strings=Object.assign(f.strings,m),!0))},f.prototype={e:{},id:0,con:{},val:"",walk:!1,lines:{},indent:0,current:0,dialogs:[],dropdowns:[],build:function(){var k=this;this.read(),this.e.container=b.createElement("div"),this.e.container.className="tail-writer-object "+this.con.classes,this.e.container.style.width=this.con.width,this.e.container.setAttribute("tail-writer-object",this.id);var l=this.e.editor.parentElement;this.e.container.appendChild(this.e.editor),l.appendChild(this.e.container),this.e.toolbar=b.createElement("div"),this.e.toolbar.className="tail-writer-toolbar tail-writer-toolbar-"+this.con.toolbarPosition,this.e.toolbar.setAttribute("data-writer-toolbar",this.con.toolbarPosition),this.e.container.insertBefore(this.e.toolbar,this.e.editor);for(var m=0;m<this.con.toolbar.length;m++){var n=this.con.toolbar[m].split(":"),o=1<n.length?n[1].split(","):[],p=g(n[0],o);if("|"===n[0]||!1!=p){if("|"===n[0]){var q=b.createElement("span");q.className="tail-writer-sep"}else{var q=b.createElement("button");q.className="tail-writer-button icon-"+p.id,q.className="tail-writer-button icon-"+p.id,q.setAttribute("data-writer-title",p.string),q.setAttribute("data-writer-action",n[0]+(0<o.length?"-"+o.join("-"):"")),q.addEventListener("click",function(u){if(u.preventDefault(),c.hasClass(u.target,"tail-writer-button")){var v=k.hideDropdown.call(k);if(v.indexOf(-1==this.getAttribute("data-writer-action"))){var x=this.getAttribute("data-writer-action").split("-");k.current=this,k.perform.call(k,x.shift(),x)}}}),!1!==this.con.tooltip&&(q.addEventListener("mouseover",function(u){k.tooltip.call(k,u,this)}),q.addEventListener("mouseout",function(u){k.tooltip.call(k,u,this)}))}this.e.toolbar.appendChild(q)}}if(this.con.statusbar&&(this.e.statusbar=b.createElement("div"),this.e.statusbar.className="tail-writer-statusbar",this.e.statusbar.innerHTML="<div class=\"tail-writer-lines\">"+j("lineCounter")+": <span class=\"tail-writer-count\"></span></div><div class=\"tail-writer-chars\">"+j("charCounter")+": <span class=\"tail-writer-count\"></span></div><div class=\"tail-writer-words\">"+j("wordCounter")+": <span class=\"tail-writer-count\"></span></div>",this.e.container.appendChild(this.e.statusbar),this.statusbar()),this.e.editor.setAttribute("data-writer-editor",this.id),!isNaN(parseInt(this.con.height[0])))var r=parseInt(this.con.height[0]);else{var r=parseInt(this.e.container.outerHeight);200>r&&(r=200)}this.e.editor.style.width=parseInt(this.con.width)+"%",this.e.editor.style.height=r+"px",this.e.editor.style.minHeight=r+"px",isNaN(parseInt(this.con.height[1]))||(this.e.editor.style.maxHeight=parseInt(this.con.height[1])+"px"),this.con.indent&&(this.e.editor.style.tabSize=this.con.indentSize),this.e.editor.className+=" tail-writer-editor";for(var t=["click","input","change","keydown","keyup"],m=0;m<t.length;m++)this.e.editor.addEventListener(t[m],function(u){k.handle.call(k,u)});return this.con.resize&&this.resize(!1),this},handle:function(k){this;if(this.read(),"click"==k.type&&this.hideDropdown.call(this),"keydown"===k.type){if(k.ctrlKey&&88==k.keyCode){k.preventDefault();var m=this.selection();if(m.start==m.end)for(var n=-1,o=m.end;-1<m.start;)if(n=0<m.start?this.val.indexOf("\n",m.start--):0,0>m.start||-1<n&&n<o){m.start=n,m.end=n+this.lines.current.length+1;break}return this.write(this.val.slice(0,m.start)+this.val.slice(m.end)),this.selection(m.start+1,m.start+1),!1}if(k.ctrlKey&&68==k.keyCode)return k.preventDefault(),this.writeLine("\n"+this.lines.current,"after");if(9==k.keyCode)return k.preventDefault(),k.shiftKey?this.perform("outdent",[]):this.perform("indent",[]);if(13==k.keyCode)return!this.walkable(this.lines.current)||(k.preventDefault(),this.writeLine(this.indenter("","create")),this.perform(this.walk[0],this.walk[1]))}this.con.resize&&this.resize(!0),this.con.statusbar&&this.statusbar()},walkable:function(k){if(!this.walk||void 0==k)return this.walk=!1,!1;var l=g(this.walk[0],this.walk[1]),m=this.indenter(l.markup.replace("$1",""));return 0>k.indexOf(m)?(this.walk=!1,!1):k!=m||(this.writeLine("","replace"),this.walk=!1,!1)},tooltip:function(k,l){if(!1==this.con.tooltip)return!1;var m=c.position(k.target),n="tail-writer-tooltip-"+k.target.getAttribute("data-writer-action");if(!c.hasClass(k.target.parentElement,"tail-writer-toolbar"))return!1;if("mouseover"==k.type){if(c.hasClass(k.target,"disabled"))return;if(0==this.e.container.querySelectorAll("."+n).length){var o=b.createElement("DIV");o.innerText=j(k.target.getAttribute("data-writer-title")),o.className="tail-writer-tooltip tail-writer-tooltip-"+this.con.tooltip+" "+n,o.style.opacity=0,o.style.position="absolute",this.e.container.insertBefore(o,this.e.container.children[0]);var p=window.getComputedStyle(this.e.toolbar);o.style.top="bottom"==this.con.tooltip?parseInt(p.top)+m.height+o.offsetHeight+"px":"-2px",o.style.left=parseInt(p.left)+m.left+m.width/2-o.offsetWidth/2+"px",c.animate(o,function(q){return!!(1>parseFloat(q.style.opacity))&&(q.style.opacity=parseFloat(q.style.opacity)+0.1,!0)},10,!0)}}else{var l=this.e.container.querySelector("."+n);l&&c.animate(l,function(q){return 0<parseFloat(q.style.opacity)?(q.style.opacity=parseFloat(q.style.opacity)-0.1,!0):(q.parentElement&&q.parentElement.removeChild(q),!1)},10,!0)}},resize:function(k){var l=this.e.editor.cloneNode(),m=a.getComputedStyle(this.e.editor),n=parseInt(m.paddingTop)+parseInt(m.paddingBottom);l.style.height="auto",l.style.minHeight="none",l.style.maxHeight="none",l.style.opacity=0,l.style.position="position",l.value=this.val,this.e.container.insertBefore(l,this.e.editor);var o=l.scrollTop,p=l.scrollHeight;this.e.container.removeChild(l,l.selectionStart),this.e.editor.style.height=p-n+"px",!0==k&&3>=this.e.editor.value.length-this.selection().start&&(this.e.editor.scrollTop=p-n)},statusbar:function(){var l={chars:this.val.length.toString(),lines:(this.val.match(/^|\n/g)||[""]).length.toString(),words:"0".toString()},m=this.val.trim().replace(/[\n\t\.]/g," ").trim();m=m.replace(/[^a-zA-Z0-9 ]/g,"").replace(/\s\s+/g," ").split(" "),l.words=1>=m.length&&0==m[0].length?0:m.length;var n=this.selection();if(n.start!==n.end){var o=this.val.slice(n.start,n.end);m=o.trim().replace(/[\n\t\.]/g," ").trim(),m=m.replace(/[^a-zA-Z0-9 ]/g,"").replace(/\s\s+/g," ").split(" "),l.chars="<span class=\"current\">"+o.length+" / </span>"+l.chars,l.lines="<span class=\"current\">"+(o.match(/^|\n/g)||[""]).length+" / </span>"+l.lines,l.words=1>=m.length&&0==m[0].length?"<span class=\"current\">0 / </span>"+l.words:"<span class=\"current\">"+m.length+" / </span>"+l.words}this.e.statusbar.querySelector(".tail-writer-lines span").innerHTML=l.lines,this.e.statusbar.querySelector(".tail-writer-chars span").innerHTML=l.chars,this.e.statusbar.querySelector(".tail-writer-words span").innerHTML=l.words},selection:function(k,l){return void 0==k?{start:this.e.editor.selectionStart,end:this.e.editor.selectionEnd}:("number"!=typeof k&&(k=this.val.length),void 0==l&&(l=k),this.e.editor.focus(),this.e.editor.selectionStart=k,this.e.editor.selectionEnd=l,!0)},indenter:function(k,l){if(this.con.indentTab)var m="\t";else var m=Array(this.con.indentSize+1).join(" ");if("count"===l){var n=k.replace(".",""),o=new RegExp(m,"gi");return n=n.replace(o,".").split(/([^\.])/),"object"==typeof n&&0<n.length?n[0].length:0}if("create"===l){for(var p=k.split("\n"),q=0;q<p.length;q++)0!==q&&(p[q]=Array(this.indent+1).join("\t")+p[q]);k=p.join("\n")}return this.con.indentTab||(k=k.replace(/\t/g,m)),k},read:function(){this.val=this.indenter(this.e.editor.value);var k=this.selection(),l=this.val.slice(0,k.start).split("\n"),m=this.val.slice(k.start,this.val.length).split("\n");this.lines={current:l.pop()+m.shift(),previous:0<l.length?l.pop():void 0,next:0<m.length?m.shift():void 0},this.indent=this.indenter(this.lines.current,"count")},write:function(k,l){this.e.editor.value=k,"object"==typeof l&&this.selection(l.start,l.end),this.read()},writeLine:function(k,l){var m=this.selection(),n=this.val.slice(0,m.start).split("\n"),o=this.val.slice(m.start,this.val.length).split("\n"),p=n.pop()+o.shift();n=0<n.length?n.join("\n")+"\n":"",o=0<o.length?"\n"+o.join("\n"):"","replace"==l?(this.e.editor.value=n+k+o,this.selection(n.length+k.length)):"before"==l?(this.e.editor.value=n+k+p+o,this.selection(n.length+k.length+p.split("\n")[0].length)):(this.e.editor.value=n+p+k+o,this.selection(n.length+k.length+p.length)),this.read()},showDropdown:function(k,l,m){var n=this;if(!c.hasClass(this.current,"disabled")){var o=b.createElement("DIV");o.innerHTML=l,o.className="tail-writer-dropdown tail-writer-dropdown-"+k,o.style.opacity=0,o.style.position="absolute",this.e.container.appendChild(o);var p=c.position(this.current),q=window.getComputedStyle(this.e.toolbar);o.style.top=p.top+p.height+"px",o.style.left=p.left+parseInt(q.left)+"px",o.tailWriter=m,c.animate(o,function(r){return!!(1>parseFloat(r.style.opacity))&&(r.style.opacity=parseFloat(r.style.opacity)+0.1,!0)},10,!0),o.querySelector("form").addEventListener("submit",function(r){r.preventDefault(),this.parentElement.tailWriter.call(n,this.elements,r)&&n.hideDropdown.call(n)})}},hideDropdown:function(){var k=[],l=this.e.container.querySelectorAll(".tail-writer-dropdown");if(0<l.length)for(var m=0;m<l.length;m++)k.push(l[m].getAttribute("data-writer-dropdown")),c.animate(l[m],function(n){return 0<parseFloat(n.style.opacity)?(n.style.opacity=parseFloat(n.style.opacity)-0.1,!0):(n.parentElement.removeChild(n),!1)},10,!0);return k},showDialog:function(k,l,m){var n=this;if(!c.hasClass(this.current,"disabled")){var o=b.createElement("DIV");o.className="tail-writer-mask",o.style.top=0,o.style.left=0,o.style.right=0,o.style.bottom=0,o.style.opacity=0,o.style.position="absolute",o.addEventListener("click",function(){n.hideDialog.call(n)}),this.e.container.appendChild(o),c.animate(o,function(q){return!!(1>parseFloat(q.style.opacity))&&(q.style.opacity=parseFloat(q.style.opacity)+0.1,!0)},10,!0);var p=b.createElement("DIV");p.innerHTML=l,p.className="tail-writer-dialog tail-writer-dialog-"+k,p.style.display="block",p.style.opacity=0,p.style.position="absolute",this.e.container.appendChild(p),p.style.top=this.e.container.offsetHeight/2-p.offsetHeight/2+"px",p.style.left=this.e.container.offsetWidth/2-p.offsetWidth/2+"px",p.tailWriter=m,c.animate(p,function(q){return!!(1>parseFloat(q.style.opacity))&&(q.style.opacity=parseFloat(q.style.opacity)+0.1,!0)},10,!0),p.querySelector("form").addEventListener("submit",function(q){q.preventDefault(),this.parentElement.tailWriter.call(n,this.elements,q)&&n.hideDialog.call(n)})}},hideDialog:function(){var k=[],l=this.e.container.querySelectorAll(".tail-writer-dialog");if(0<l.length)for(var m=0;m<l.length;m++)k.push(l[m].getAttribute("data-writer-dialog")),c.animate(l[m],function(n){return 0<parseFloat(n.style.opacity)?(n.style.opacity=parseFloat(n.style.opacity)-0.1,!0):(n.parentElement.removeChild(n),!1)},10,!0);return this.e.container.querySelector(".tail-writer-mask")&&c.animate(this.e.container.querySelector(".tail-writer-mask"),function(n){return 0<parseFloat(n.style.opacity)?(n.style.opacity=parseFloat(n.style.opacity)-0.1,!0):(n.parentElement.removeChild(n),!1)},10,!0),k},remove:function(){this.e.container.removeChild(this.e.toolbar),this.e.container.removeChild(this.e.statusbar);var k=this.e.container.querySelector("textarea");return k.removeAttribute("data-writer-editor"),c.removeClass(k,"tail-writer-editor"),this.e.container.parentElement.replaceChild(k,this.e.container),!0},perform:function(k,l){var m=g(k,l);return!1!==m&&("function"==typeof m.callback?m.callback.call(this,m.markup,m,k,l):0<=["inline","block"].indexOf(m.callback)&&this["do_"+m.callback].call(this,m.markup,m,k,l),"undefined"!=typeof m.walker&&m.walker&&(this.walk=[k,l,this.walk instanceof Array?this.walk[2]++:0]),!1)},do_inline:function(k,l){var n=this.selection(),o=this.val.slice(0,n.start),p=this.val.slice(n.start,n.end),q=this.val.slice(n.end,this.val.length);n.start!==n.end&&-1<p.indexOf("\n\n")?(n.start=o.length,n.end=o.length+(k.length-2)*((p.match(/\n\n/g)||[]).length+1)+p.length,p=p.split("\n\n"),p.forEach(function(r,t){p[t]=k.replace("$1",p[t])}),p=h(l,o,p.join("\n\n"),q,n)):(n.start=o.length+k.indexOf("$1"),n.end=o.length+k.indexOf("$1")+p.length,p=h(l,o,k.replace("$1",p),q,n)),this.write(o+p+q,n)},do_block:function(k,l){var n=this.selection(),o=this.val.slice(0,n.start),p=this.val.slice(n.start,n.end),q=this.val.slice(n.end,this.val.length);if(n.start!==n.end){var r=this;p=p.replace(/[^|\n]([^\n]+)/g,function(t){return r.indenter(k.replace("$1",t),"create")}),p=h(l,o,p,q,n)}else 0<o.length&&o.length>o.lastIndexOf("\n")+1&&(o+="\n"),p=this.indenter(k.replace("$1",""),"create"),n.start=n.end=o.length+p.length,p=h(l,o,p,q,n);this.write(o+p+q,n)}},"undefined"==typeof a.tail&&(a.tail={}),a.tail.writer=f,"undefined"!=typeof jQuery&&jQuery.fn.extend({tailWriter:function(k){return this.each(function(){return new f(this,k)})}}),"undefined"!=typeof document.id&&Element.implement({tailWriter:function(k){return new f(this,k)}})})(window,document);
